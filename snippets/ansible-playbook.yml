ğŸ“˜ Ansible Cheat Sheet (with Explanations)
Command	Explanation
ansible all -m ping	Test connectivity to all hosts in inventory
ansible-playbook site.yml	Run a playbook named site.yml
ansible -i inventory.ini web -m shell -a "uptime"	Run shell command uptime on web group
ansible-galaxy init role_name	Create a new role structure
ansible-vault encrypt file.yml	Encrypt sensitive files (e.g., secrets)
ansible-vault decrypt file.yml	Decrypt file
ansible-vault edit file.yml	Edit encrypted file
ansible-doc -l	List all available modules
ansible-playbook play.yml --check	Dry-run mode (no changes applied)
ansible-playbook play.yml --diff	Show differences when files change
ğŸ‘‰ Inventory files (inventory.ini) define hosts and groups. Playbooks (.yml) define tasks.

#======================================================================================================

#ğŸ“„ Template for Ansible Playbook


- name: Example Playbook
  hosts: webservers
  become: true   # run with sudo
  vars:
    app_port: 8080

  tasks:
    - name: Ensure latest apt cache
      apt:
        update_cache: yes

    - name: Install Nginx
      apt:
        name: nginx
        state: present

    - name: Start Nginx service
      service:
        name: nginx
        state: started
        enabled: true
#ğŸ‘‰ This template shows variables, tasks, and privilege escalation (become: true).

#======================================================================================================

#ğŸ“ Basic â†’ Advanced Playbook Examples

#1. Basic: Ping All Hosts

- name: Ping all hosts
  hosts: all
  tasks:
    - name: Ping
      ping:

#======================================================================================================

#2. Intermediate: Deploy Web App


- name: Deploy Flask App
  hosts: webservers
  become: true

  tasks:
    - name: Install Python and pip
      apt:
        name: "{{ item }}"
        state: present
      loop:
        - python3
        - python3-pip

    - name: Copy app files
      copy:
        src: ./app/
        dest: /opt/app/

    - name: Install requirements
      pip:
        requirements: /opt/app/requirements.txt

    - name: Run app with systemd
      systemd:
        name: flaskapp
        state: started
        enabled: true

#======================================================================================================

#3. Advanced: Multiâ€‘Tier Deployment


- name: Deploy Full Stack
  hosts: all
  become: true

  roles:
    - role: common
    - role: web
    - role: db

# Example role: roles/web/tasks/main.yml
- name: Install Nginx
  apt:
    name: nginx
    state: present

- name: Configure Nginx
  template:
    src: nginx.conf.j2
    dest: /etc/nginx/nginx.conf
  notify: restart nginx

# Handlers: roles/web/handlers/main.yml
- name: restart nginx
  service:
    name: nginx
    state: restarted
    enabled: true


#ğŸ‘‰ This shows roles, templates, and handlers â€” the building blocks of scalable Ansible projects.

#âœ… Summary
#Cheat sheet â†’ quick reference for everyday Ansible commands.

#Template â†’ reusable playbook structure with variables, tasks, and handlers.

#Scripts â†’ progression from simple ping â†’ app deployment â†’ multiâ€‘tier roleâ€‘based architecture.

#======================================================================================================

#ğŸ“˜ Ansible Variables (vars)
#Variables let you parameterize playbooks and roles, making them reusable and flexible.


#Example: Using vars in a Playbook


- name: Deploy Web App
  hosts: webservers
  become: true

  vars:
    app_port: 8080
    app_dir: /opt/app

  tasks:
    - name: Install Nginx
      apt:
        name: nginx
        state: present

    - name: Configure Nginx
      template:
        src: nginx.conf.j2
        dest: /etc/nginx/nginx.conf

    - name: Start Nginx
      service:
        name: nginx
        state: started
        enabled: true


#ğŸ‘‰ Explanation:

#vars: block defines app_port and app_dir.

#These can be referenced in templates ({{ app_port }}) or tasks.

#Keeps playbooks DRY and configurable.

#======================================================================================================

#ğŸ” Ansible Vault (Secrets Management)
#Vault allows you to encrypt sensitive data (like passwords, API keys) inside playbooks or variable files.

#Encrypt a File
bash
ansible-vault encrypt secrets.yml
Decrypt a File
bash
ansible-vault decrypt secrets.yml
Edit an Encrypted File
bash
ansible-vault edit secrets.yml
Run Playbook with Vault
bash
ansible-playbook site.yml --ask-vault-pass

#======================================================================================================

#ğŸ“ Example: Vault + Vars in Playbook


- name: Secure Deployment
  hosts: dbservers
  become: true

  vars_files:
    - secrets.yml   # Encrypted with Ansible Vault

  tasks:
    - name: Install PostgreSQL
      apt:
        name: postgresql
        state: present

    - name: Configure DB user
      postgresql_user:
        name: "{{ db_user }}"
        password: "{{ db_password }}"
        state: present

#ğŸ‘‰ Explanation:

#vars_files: loads variables from secrets.yml.

#db_user and db_password are encrypted with Vault.

#Playbook references them securely without exposing plaintext.

#âœ… Summary

#Vars â†’ parameterize playbooks for flexibility.

#Vault â†’ encrypt secrets for secure automation.

#Combined â†’ secure, reusable, productionâ€‘grade playbooks.

#======================================================================================================

#ğŸ“˜ Roleâ€‘Based Variable Organization
#In Ansible, variables can live in different places depending on scope:

#defaults/main.yml â†’ lowest precedence, safe defaults for a role.

#vars/main.yml â†’ higher precedence, roleâ€‘specific variables.

#Inventory/group_vars/host_vars â†’ environmentâ€‘specific overrides.

#Playbook vars â†’ highest precedence in a playbook run.


#======================================================================================================

#Example Role Structure
Code
roles/
  web/
    tasks/
      main.yml
    handlers/
      main.yml
    templates/
      nginx.conf.j2
    vars/
      main.yml
    defaults/
      main.yml


#defaults/main.yml

# Default values (can be overridden)
app_port: 8080
app_dir: /opt/app

#vars/main.yml

# Role-specific values (higher precedence)
nginx_package: nginx
nginx_service: nginx

#=====================================================================================================

#tasks/main.yml
---
- name: Install Nginx
  apt:
    name: "{{ nginx_package }}"
    state: present

- name: Configure Nginx
  template:
    src: nginx.conf.j2
    dest: /etc/nginx/nginx.conf
  notify: restart nginx

#=====================================================================================================

#handlers/main.yml

- name: restart nginx
  service:
    name: "{{ nginx_service }}"
    state: restarted

#ğŸ‘‰ Explanation:

#Defaults provide safe fallbacks.

#Vars define roleâ€‘specific constants.

#Tasks and handlers reference variables with {{ var_name }}.

#Templates can interpolate variables (e.g., listen {{ app_port }}).

#=====================================================================================================

#ğŸ” Vault + Vars in Roles
#You can store sensitive variables in Vault and load them into roles.

#=====================================================================================================

#Example: group_vars/prod/secrets.yml (encrypted with Vault)

db_user: produser
db_password: SuperSecret123

#=====================================================================================================

#Playbook referencing Vault

yaml
- name: Deploy Database
  hosts: dbservers
  become: true

  vars_files:
    - group_vars/prod/secrets.yml

  roles:
    - db

#ğŸ‘‰ Explanation:

#Vault keeps secrets encrypted.

#vars_files loads them securely.

#Roles can consume them without exposing plaintext.

#âœ… Summary

#Vars â†’ parameterize playbooks and roles.

#Defaults vs Vars â†’ control precedence and flexibility.

#Vault â†’ secure secrets management.

#Role structure â†’ scalable, maintainable Ansible projects.

MY EXAMPLE:
- name: deploy application
  hosts: appservers
  remote_user: ubuntu
  become: yes
  tasks:
    - name: copy application files
      ansible.builtin.script: ./prod.sh

- name: restart application
  hosts: appservers
  remote_user: ubuntu
  become: yes
  tasks:
    - name: restart application using docker-compose
      ansible.builtin.script: ./update.sh

- name: install nginx
  hosts: nginx
  remote_user: ubuntu
  become: yes
  tasks:
    - name: install nginx using script
      ansible.builtin.script: ./nginx.sh

- name: deploy nginx configuration
  hosts: nginx
  remote_user: ubuntu
  become: yes
  tasks:
    - name: copy nginx configuration file
      ansible.builtin.copy:
        src: ./loadbalancer.conf
        dest: /etc/nginx/conf.d/loadbalancer.conf
        owner: root
        group: root
        mode: '0644'

- name: restart nginx
  hosts: nginx
  remote_user: ubuntu
  become: yes
  tasks:
    - name: restart nginx service
      ansible.builtin.script: ./restart_nginx.sh